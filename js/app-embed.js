var j=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);import{g as L,d as D,q as E,y,$ as w,u as m,F as T,C as g,i as q,a as O,T as b,b as H,k as A,r as M,c as N,e as $,o as F,O as _}from"./stylex-DTAXWz7o.js";var se=j((ie,R)=>{const B=()=>document.querySelector("cart-drawer")||document.querySelector("dialog.cart-drawer__dialog"),z=()=>document.querySelector(".order-value-booster-side-cart")?.parentElement,G=()=>{const t=document.querySelectorAll("cart-notification .cart-notification__links");return t[t.length-1]},U=()=>{const t=document.querySelectorAll(".side-cart");return t[t.length-1]},x=()=>document.querySelector('form[action$="/cart"]'),Q=()=>document.querySelector(".essential-upsell-side-cart"),V=()=>{const t=document.querySelector(".essential-upsell-side-cart-top, .essential-upsell-side-cart-bottom");return t?t.parentElement:null},P=()=>Q()||V()||z()||G()||U()||x(),p=()=>B()||P(),Y=({defaultPlacementSelectors:t})=>{for(const e of t){const r=document.querySelector(e);if(r)return r}return null},J=({isFallbackActive:t})=>t?L()||document.querySelector("product-info"):null,K=({defaultPlacementSelectors:t,isFallbackActive:e})=>Y({defaultPlacementSelectors:t})||J({isFallbackActive:e}),W=({setPortalContainer:t,defaultPlacementSelectors:e,isFallbackActive:r})=>{const n=K({defaultPlacementSelectors:e,isFallbackActive:r});return n?(t(n),()=>{t(null)}):null},C=({selectors:t})=>t.map(e=>Array.from(document.querySelectorAll(e))).flat(),I=({appBlockSelectors:t,manualBlockSelectors:e,defaultPlacementSelectors:r,isFallbackActive:n})=>{const[s,l]=D(null),c=E(()=>{const i=p(),a=C({selectors:t});return Array.from(a).some(d=>i?!i.contains(d):!0)?null:W({setPortalContainer:l,defaultPlacementSelectors:r,isFallbackActive:n})},[t,r,n]),o=E(()=>{const i=p(),u=C({selectors:e}).find(d=>i?!i.contains(d):!1);if(u){l(u);return}return c()},[c,e]);return y(o,[o]),{productPagePortalContainer:s}},X=({funnel:t,productPageProduct:e,cartItems:r,firstShopProductId:n,shopMoneyFormat:s})=>{const{productPagePortalContainer:l}=I({appBlockSelectors:["essential-upsell-cross-sell-app-block"],manualBlockSelectors:[".essential-upsell-cross-sell-block",".essential-upsell-block"],defaultPlacementSelectors:[".essential-upsell-cross-sell-default-placement",".essential-upsell-default-placement"],isFallbackActive:!!e});return l?w(m(T,{funnel:t,productPageProduct:e,cartItems:r,firstShopProductId:n,shopMoneyFormat:s}),l):null},Z=()=>document.querySelector("cart-items.page-width")||document.querySelector("cart-items .page-width")||document.querySelector("cart-items")||document.querySelector("cart-items-component .cart-page .cart-page__items"),v=({funnel:t,element:e,setPortalContainer:r})=>{const n=document.createElement("div");return t.placement.cartPagePositionType===g.TOP_OF_THE_CART?e.prepend(n):t.placement.cartPagePositionType===g.BOTTOM_OF_THE_CART&&e.append(n),r(n),()=>{r(null),n.remove()}},k=({funnel:t,element:e,setPortalContainer:r})=>{if(t.placement.cartPagePositionType===g.TOP_OF_THE_CART){const n=e.querySelector(".essential-upsell-side-cart-top");if(n)return r(n),()=>{r(null)};if(e.querySelector("cart-drawer-items.is-empty")||e.classList.contains("cart-drawer--empty")){r(null);return}const s=e.querySelector("cart-drawer-items:not(.is-empty)")||e.querySelector(".drawer__scrollable");if(s){const o=document.createElement("div");return s.append(o),r(o),()=>{r(null),o.remove()}}const l=e.querySelector("scroll-hint.cart-drawer__items");if(l){const o=document.createElement("div");return l.prepend(o),r(o),()=>{r(null),o.remove()}}const c=document.createElement("div");return e.prepend(c),r(c),()=>{r(null),c.remove()}}else if(t.placement.cartPagePositionType===g.BOTTOM_OF_THE_CART){const n=e.querySelector(".essential-upsell-side-cart-bottom");if(n)return r(n),()=>{r(null)};const s=e.querySelector(".drawer__footer");if(s){const o=document.createElement("div");return s.prepend(o),r(o),()=>{r(null),o.remove()}}const l=e.querySelector("scroll-hint.cart-drawer__items");if(l){const o=document.createElement("div");return l.append(o),r(o),()=>{r(null),o.remove()}}const c=document.createElement("div");return e.append(c),r(c),()=>{r(null),c.remove()}}},ee=()=>{if(!q())return null;const t=document.querySelectorAll('form[action$="/cart"]'),e=t[t.length-1];return e?e.parentNode:null},te=({funnel:t,setPortalContainer:e})=>{const r=Z();if(r)return v({funnel:t,element:r,setPortalContainer:e});const n=B();if(n)return k({funnel:t,element:n,setPortalContainer:e});const s=ee();if(s)return v({funnel:t,element:s,setPortalContainer:e});const l=P();if(l)return k({funnel:t,element:l,setPortalContainer:e})},re=({funnel:t,productPageProduct:e,cartItems:r,firstShopProductId:n,shopMoneyFormat:s})=>{const[l,c]=D(null),o=E(()=>{const a=q()?document:p();return a&&a.querySelector("essential-upsell-cross-sell-app-block")?null:te({funnel:t,setPortalContainer:c})},[t]),i=E(()=>{const a=q()?document:p(),u=a&&(a.querySelector(".essential-upsell-cross-sell-block")||a.querySelector(".essential-upsell-block"));if(u){c(u);return}return o()},[o]);return y(i,[i]),y(()=>{if(!l)return;const a=new MutationObserver(u=>{u.some(h=>Array.from(h.removedNodes).some(S=>S.contains(l)))&&(c(null),l.remove(),i())});return a.observe(document.body,{childList:!0,subtree:!0}),()=>{a.disconnect()}},[i,l]),y(()=>{if(l)return;const a=p();if(!a)return;const u=new MutationObserver(d=>{d.some(S=>Array.from(S.addedNodes).some(f=>!(f instanceof Element)||!f.querySelector?!1:!!f.querySelector("cart-drawer-items:not(.is-empty)")||!!f.querySelector(".essential-upsell-side-cart-top, .essential-upsell-side-cart-bottom")))&&o()});return u.observe(a,{childList:!0,subtree:!0}),()=>{u.disconnect()}},[o,l]),l?w(m(T,{funnel:t,productPageProduct:e,cartItems:r,firstShopProductId:n,shopMoneyFormat:s}),l):null},ne=({funnels:t,productPageProduct:e,productPageCollectionIds:r,cartItems:n,firstShopProductId:s,shopMoneyFormat:l})=>{const c=O({funnels:t,productPageProduct:e,productPageCollectionIds:r}),o=b(()=>H({funnels:t,cartItems:n}),[t,n]);return m(A,{children:[c&&m(X,{funnel:c,productPageProduct:e,cartItems:n,firstShopProductId:s,shopMoneyFormat:l}),o&&m(re,{funnel:o,productPageProduct:e,cartItems:n,firstShopProductId:s,shopMoneyFormat:l})]})},le=({funnel:t,productPageProduct:e,cartItems:r,firstShopProductId:n,shopMoneyFormat:s,productPageCollectionIds:l})=>{const{productPagePortalContainer:c}=I({appBlockSelectors:["essential-upsell-frequently-bought-together-app-block"],manualBlockSelectors:[".essential-upsell-frequently-bought-together-block"],defaultPlacementSelectors:[".essential-upsell-frequently-bought-together-default-placement",".essential-upsell-default-placement"],isFallbackActive:!!e});return c?w(m(T,{funnel:t,productPageProduct:e,cartItems:r,firstShopProductId:n,shopMoneyFormat:s,productPageCollectionIds:l}),c):null},oe=({funnels:t,productPageProduct:e,productPageCollectionIds:r,cartItems:n,firstShopProductId:s,shopMoneyFormat:l})=>{const c=O({funnels:t,productPageProduct:e,productPageCollectionIds:r});return c?m(le,{funnel:c,productPageProduct:e,cartItems:n,firstShopProductId:s,shopMoneyFormat:l,productPageCollectionIds:r}):null},ce=t=>{const{funnels:e,productPageCollectionIds:r,cartItems:n,firstShopProductId:s,productPageProduct:l,shopMoneyFormat:c}=N({liquidProps:t}),{cartItems:o}=$({liquidCartItems:n}),i=b(()=>e.filter(u=>F({funnel:u})===_.FREQUENTLY_BOUGHT_TOGETHER),[e]),a=b(()=>e.filter(u=>F({funnel:u})===_.CROSS_SELL),[e]);return m(A,{children:[m(oe,{funnels:i,productPageProduct:l,productPageCollectionIds:r,cartItems:o,firstShopProductId:s,shopMoneyFormat:c}),m(ne,{funnels:a,productPageProduct:l,productPageCollectionIds:r,cartItems:o,firstShopProductId:s,shopMoneyFormat:c})]})};M(ce,"essential-upsell-app-embed",["upsellAppData","productPageProduct","productPageCollectionIds","cartItems","firstShopProductId","shopMoneyFormat"]);typeof R>"u"&&(window.module={exports:{}})});export default se();
